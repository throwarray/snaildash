<!DOCTYPE html>
<html lang="en" dir="ltr">
	<head>
		<meta charset="utf-8">
		<style>
			#myform > * {
				display: block;
			}

		</style>
	</head>
	<body>
		<form id="myform" action="index.html" method="post">
			<input required type="email" name="email" value="" placeholder="Email"/>
			<input required minlength="6" maxlength="18" type="password" name="password" placeholder="Password"/>
			<input required minlength="6" maxlength="18" type="password" name="confirm" placeholder="Confirm password"/>
			<div>
				Agree to terms of service <input required type="checkbox" name="agree"/>
			</div>
			<button>OK</button>
		</form>
		<script type="text/javascript">
			const form = document.querySelector('#myform')
			const agree = form.querySelector('[name="agree"]')
			const pass = form.querySelector('[name="password"]')
			const confirm = form.querySelector('[name="confirm"]')
			const stripFields = [confirm, agree]

			function passwordsMatch () {
				if (pass.value !== confirm.value) {
					confirm.setCustomValidity("Password fields must match.");
				} else {
					confirm.setCustomValidity("")

					return true
				}
			}

			confirm.addEventListener('input', passwordsMatch)

			form.addEventListener('submit', function (evt) {
				evt.preventDefault()

				if (!form.checkValidity()) return

				const data = Array.prototype.slice.call(form.querySelector('input'))
					.reduce(function (data, child) {
						if (stripFields.indexOf(child) === -1 && child.getAttribute('name'))
							data[child.getAttribute('name')] = child.value

						return data
					}, {})

				if (window.top !== window)
				{
					// Send data
				}

				form.reset()
			})


		</script>
	</body>
</html>
